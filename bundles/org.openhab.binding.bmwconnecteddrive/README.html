<?xml version='1.0' encoding='utf-8' ?><!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
	<head>
		<meta http-equiv="Content-Type" content="text/html; charset=utf-8"/>
	</head>
	<body>
		<h1 id="bmw-connecteddrive-binding">BMW ConnectedDrive Binding</h1><img align="right" src="./doc/bmw-connected.png" width="150" height="150"/>
		<p>The Binding connects your BMW Vehicles which are registered in the
			<em>Garage</em>of your BMW ConnectedDrive Portal.
			Due to the high variety of Cars and ConnectedDrive Services you need to check which Channels are applicable to your Car. 
			The Discovery Service recognizes your Car with the correct type 
		</p>
		<ul>
			<li>Conventional Fuel Vehicle</li>
			<li>Plugin-Hybrid Electrical Vehicle </li>
			<li>Battery Electric Vehicle with Range Extender</li>
			<li>Batterie Electric Vehicle </li>
		</ul>
		<p>In addition Properties are attached to the Vehcile Thing to obeserve the Suppoerted &amp; Activated Services.
			Different Channel Groups are available so you are able to cross-check which group is supported by your Car.
			<br/>
		</p>
		<h2 id="supported-things">Supported Things</h2>
		<h3 id="bridge">Bridge</h3>
		<p>The Bridge establishes the Connection between BMW ConnectedDrive Portal and opanHAB.</p>
		<p>| Name                       | Bridge Type ID | Description                                                |
			|----------------------------|----------------|------------------------------------------------------------|
			| BMW ConnectedDrive Account | account        | Access to BMW ConnectedDrive Portal for a specific user    |</p>
		<h3 id="things">Things</h3>
		<p>Four different Vehicle Types are provided. They differ in the supported Channel Groups &amp; Channels. 
			While Conventional Fuel Vehicles have no "Charging Profile" Electric Vehicles don't provide a _fuel range_. 
			For Hybrid Vehicles
			<em>fuel range</em>and
			<em>electric range</em>is provided and in addition a
			<em>combined range</em>
		</p>
		<p>| Name                                | Thing Type ID | Supported Channel Groups                                   |
			|-------------------------------------|---------------|------------------------------------------------------------|
			| BMW Electric Vehicle                | BEV           | status, range, last-trip, all-trips, charge-profile, image, troubeshoot |
			| BMW Electric Vehicle with REX       | BEV_REX       | status, range, last-trip, all-trips, charge-profile, image, troubeshoot |
			| BMW Plug-In-Hybrid Electric Vehicle | PHEV          | status, range, last-trip, all-trips, image, troubeshoot |
			| BMW Conventional Vehicle            | CONV          | status, range, last-trip, all-trips, image, troubeshoot |</p>
		<h4 id="properties">Properties</h4><img align="right" src="./doc/properties.png" width="600" height="400"/>
		<p>For each Vehicle Properties are set with various informations. 
			They are especially handy to figure out the provided Services of your Vehicle. 
			In the right picture you can see in
			<em>Activated Services</em>e.g. the
			<em>DoorLock</em>and
			<em>DoorUnlock</em>Services are mentioned. 
			So you're sure that in Channel Group
			<em>Remote Services</em>you are able to execute these commands.
			Also
			<em>LastDestinations</em>is mentioned in
			<em>Supported Services</em>so it's valid to connect Channel Group
			<em>Last Destinations</em>in order to display the last 3 Navigation Destinations.
		</p>
		<p>Basically 3 Types of Information are registered as Properties</p>
		<ul>
			<li>Informations regarding your Dealer with Address and Phone Number</li>
			<li>Which services are available or not available</li>
			<li>Vehicle Properties like Color, Model Type, Drive Train and Construction Year</li>
		</ul>
		<h2 id="discovery">Discovery</h2>
		<p>Auto Discovery is starting after you created the Bridge towards BMW ConnectedDrive. 
			A list of your registered Vehicles is queried and all found Vehicles are added in Inbox.
			As Unique Identifier the
			<em>Vehicle Identification Number</em>(VIN) is used. 
			If you already predefined a Thing in *.things configuration with the same VIN the Discovery won't discover it again. 
			The Discovery still takes care updating the Properties of your Vehicle.
		</p>
		<h2 id="configuration">Configuration</h2>
		<h3 id="bridge2">Bridge</h3>
		<p>| Parameter       | Type    | Description                                                             |
			<br/>
			|-----------------|---------|-------------------------------------------------------------------------|
			| userName        | text    | BMW Connected Drive Username                  |
			| password        | text    | BMW Connected Drive Password                  |
			| region          | text    | Select your Region in order to connect to the appropriate BMW Server.   |
		</p>
		<p>The region Configuration has 3 different possibilities</p>
		<ul>
			<li>
				<em>NORTH_AMERICA</em>
			</li>
			<li>
				<em>CHINA</em>
			</li>
			<li>
				<em>ROW</em>for Rest of World
			</li>
		</ul>
		<h3 id="things2">Things</h3>
		<p>All Things are needing the same Configuration Data</p>
		<p>| Parameter       | Type    | Description                                                             |
			<br/>
			|-----------------|---------|-------------------------------------------------------------------------|
			| vin             | text    | Vehicle Identification Number (VIN)               |
			| refreshInterval | integer | Refresh Interval in Minutes             |
			| units           | text    | Unit Selection   |
			| imageSize       | integer | Image Picture Size&lt;  |
			| imageViewport   | text    | Image Viewport  |
		</p>
		<p>The units can be configured in 3 ways</p>
		<ul>
			<li>
				<em>AUTODETECT</em>selects Miles for US &amp; UK, Kilometre otherwise
			</li>
			<li>
				<em>METRIC</em>selects directly Kilometers
			</li>
			<li>
				<em>IMPERIAL</em>selects directly Miles
			</li>
		</ul>
		<p>The imageVieport allows you to show your Car from different angels.
			Possible values are FRONT, REAR, SIDE, DASHBOARD or DRIVERDOOR</p>
		<h2 id="channels">Channels</h2>
		<p>There are many Channels available for each Vehicle. 
			For better overview they are clustered in different Channel Groups.
			The Channel Groups are different for the Car Types but also depends on the build in Sensors of your Car.
			This means also the Construction Year is relevant if some Channels are supported or not.</p>
		<h3 id="channel-group-_vehicle-status_">Channel Group
			<em>Vehicle Status</em>
		</h3>
		<p>Available for all Vehicles.</p>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type   | Description                                       |
			|-----------------------|------------------|---------------------|--------|---------------------------------------------------|
			| Door Status           | status           | doors               | String | Closed if all closed, else reports the Door which is still open |
			| Window Status         | status           | windows             | String | Closed if all closed, else reports the Window which is still open |
			| Doors Locked          | status           | lock                | String | Status if Doors are locked or unlocked |
			| Upcoming Service      | status           | service             | String | Upcoming Service either after certain Mileage, Date, or both  |
			| Check Control         | status           | check-control       | String | Description of actual Check Control message, Ok if none is activae   |</p>
		<h3 id="channel-group-_range-data_">Channel Group
			<em>Range Data</em>
		</h3>
		<p>Available for all Vehicles.
			Based on Vehicle Type (Thing Type ID) the Channel is presented or not. 
			For Conventional Fuel Cars the
			<em>Remaining Electric Range</em>isn't presented while for Battery Electric Vehicles
			<em>Remaining Range Fuel</em>isn't valid.
			Hybrid Vehicles have both and in addition
			<em>Remaining Hybrid Range</em>
		</p>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type          | Valid for | Description                                       |
			|-----------------------|------------------|---------------------|---------------|-----------|----------------------------------------|
			| Mileage               | range            | mileage             | Number:Length | All       | Total Distance Driven                   |
			| Hybrid Range          | range            | range-hybrid        | Number:Length | All       | Total Distance Driven                   |
			| Battery Range         | range            | range-electric      | Number:Length | All       | Total Distance Driven                   |
			| Battery Charge Level  | range            | soc                 | Number:Length | All       | Total Distance Driven                   |
			| Fuel Range            | range            | range-fuel          | Number:Length | All       | Total Distance Driven                   |
			| Remaining Fuel        | range            | remaining-fuel      | Number:Length | All       | Total Distance Driven                   |</p>
		<h3 id="channel-group-_last-trip_">Channel Group
			<em>Last Trip</em>
		</h3>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type   | Description                                       |
			|-----------------------|------------------|---------------------|--------|---------------------------------------------------|
			| Modbus-ID             | status           | modbus-id           | String | Modbus ID / Magic Byte of E3DC                    |</p>
		<h3 id="channel-group-_lifetime-statistics_">Channel Group
			<em>Lifetime Statistics</em>
		</h3>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type   | Description                                       |
			|-----------------------|------------------|---------------------|--------|---------------------------------------------------|
			| Modbus-ID             | range           | modbus-id           | String | Modbus ID / Magic Byte of E3DC                    |</p>
		<h3 id="channel-group-_vehicle-location_">Channel Group
			<em>Vehicle Location</em>
		</h3>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type   | Description                                       |
			|-----------------------|------------------|---------------------|--------|---------------------------------------------------|
			| Modbus-ID             | status           | modbus-id           | String | Modbus ID / Magic Byte of E3DC                    |</p>
		<h3 id="channel-group-_remote-services_">Channel Group
			<em>Remote Services</em>
		</h3>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type   | Description                                       |
			|-----------------------|------------------|---------------------|--------|---------------------------------------------------|
			| Modbus-ID             | range           | modbus-id           | String | Modbus ID / Magic Byte of E3DC                    |</p>
		<h3 id="channel-group-_image_">Channel Group
			<em>Image</em>
		</h3>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type   | Description                                       |
			|-----------------------|------------------|---------------------|--------|---------------------------------------------------|
			| Modbus-ID             | status           | modbus-id           | String | Modbus ID / Magic Byte of E3DC                    |</p>
		<h3 id="channel-group-_troubleshooting_">Channel Group
			<em>Troubleshooting</em>
		</h3>
		<p>| Channel Label         | Channel Group ID | Channel ID          | Type   | Description                                       |
			|-----------------------|------------------|---------------------|--------|---------------------------------------------------|
			| Modbus-ID             | range           | modbus-id           | String | Modbus ID / Magic Byte of E3DC                    |</p>
		<h2 id="troubleshooting">TroubleShooting</h2>
		<p>In order to to identify issues the TroubleShooting Channels are providing Analysis Informations</p>
		<h3 id="discovery2">Discovery</h3>
		<p>If your Vehicle isn't discovered correctly perform the following steps</p>
		<ul>
			<li>Check if your Vehicle is attached correctly in ConnectedDrive. Only if it's attached to your ConnectedDrive Account it's possible to detect it.</li>
			<li>In the below example sitemap the Switch
				<em>Log Discovery Fingerprint</em>can be executed. 
			</li>
		</ul>
		<h3 id="car-data">Car Data</h3>
		<h3 id="update-timestamp">Update Timestamp</h3>
		<p>There's a timestamp showing the last update of your Vehicle. If this isn't shown correctly please check the date settings.
			In case of Raspberry Pi execute
			<em>raspi-cinfig_, select _Localization Options_, the _Change Time Zone</em>
			Select your
			<em>Geaographical Area</em>and afterwards the correct City.
			One restart of openHAB service with
			<em>systemctl restart openhab2</em>is necessary in order to see the corrected Time Settings.
		</p>
		<h2 id="full-example">Full Example</h2>
		<p>The example is based on a BMW i3 with Range Extender (REX). 
			Exchange the 3 configuration parameters in the Things section</p>
		<ul>
			<li>YOUR_USERNAME - with your ConnectedDrive Login Username</li>
			<li>YOUR_PASSWORD - with your ConnectedDrive Password Credentials</li>
			<li>VEHICLE_VIN - the Vehicle Identification Number</li>
		</ul>
		<p>and you're ready to go!</p>
		<h3 id="things3">Things</h3>
		<pre><code>Bridge bmwconnecteddrive:account:user   "BMW ConnectedDrive Account" [userName="YOUR_USERNAME",password="YOUR_PASSWORD",region="ROW"] {
         Thing BEV_REX i3       "BMW i3 94h REX"                [ vin="VEHICLE_VIN",units="AUTODETECT",imageSize=2048,imageViewport="FRONT",refreshInterval=15]
}</code></pre>
		<h3 id="items">Items</h3>
		<pre><code>Number:Length           i3Mileage                 "Odometer"                 &lt;chart&gt;    (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:range#mileage" }                                                                           
Number:Length           i3Range                   "Hybrid Range"             &lt;motion&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:range#remaining-range-hybrid"}
Number:Length           i3RangeElectric           "Electric Range"           &lt;motion&gt;   (i3,long)   {channel="bmwconnecteddrive:BEV_REX:user:i3:range#remaining-range-electric"}   
Number:Length           i3RangeFuel               "Fuel Range"               &lt;motion&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:range#remaining-range-fuel"}
Number:Dimensionless    i3BatterySoc              "Battery Charged"          &lt;battery&gt;  (i3,long)   {channel="bmwconnecteddrive:BEV_REX:user:i3:range#remaining-soc"}
Number:Dimensionless    i3Fuel                    "Fuel Charged"             &lt;oil&gt;      (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:range#remaining-fuel"}
String                  i3LastUpdate              "Updated"                  &lt;calendar&gt; (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:range#last-update"}

String                  i3DoorStatus              "Door Status"       &lt;lock&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:status#doors" }
String                  i3WindowStatus            "Window Status"       &lt;lock&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:status#windows" }
String                  i3LockStatus              "Locked Status"       &lt;lock&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:status#lock" }
String                  i3ServiceStatus           "Service"       &lt;calendar&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:status#service" }
String                  i3CheckControl            "Check Control"       &lt;error&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:status#check-control" }
String                  i3ChargingStatus          "Charging"       &lt;batterylevel&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:status#charging-status" }

Number:Length           i3TripDistance            "Distance"                 &lt;chart&gt;    (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:last-trip#distance" }                                                                           
Number:Length           i3TripDistanceSinceCharge "Driven Since last Charge" &lt;chart&gt;    (i3,long)    {channel="bmwconnecteddrive:BEV_REX:user:i3:last-trip#distance-since-charging" }                                                                           
Number:Energy           i3AvgTripConsumption      "Average Consumption"      &lt;energy&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:last-trip#average-consumption" }                                                                           
Number:Energy           i3AvgTripRecuperation     "Average Recuperation"     &lt;energy&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:last-trip#average-recuperation" }                                                                           

Number:Length           i3CumulatedElectric       "Eletric Driven Distance"  &lt;chart&gt;    (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:lifetime#cumulated-driven-distance" }                                                                           
Number:Length           i3LongestEVTrip           "Longest Eletric Trip"     &lt;chart&gt;    (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:lifetime#single-longest-distance" }                                                                           
Number:Energy           i3AvgConsumption          "Average Consumption"      &lt;energy&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:lifetime#average-consumption" }                                                                           
Number:Energy           i3AvgRecuperation         "Average Recuperation"     &lt;energy&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:lifetime#average-recuperation" }  

Number                  i3Longitude               "Location Longitude"       &lt;zoom&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:location#longitude" }                                                                           
Number                  i3Latitude                "Location Latitude"        &lt;zoom&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:location#latitude" }                                                                           
String                  i3LatLong                 "Location as String"       &lt;zoom&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:location#latlong" }
Number:Angle            i3Heading                 "Vehicle Heading"          &lt;zoom&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:location#heading" }  
Number                  i3RangeRadius             "Range Radius"             &lt;zoom&gt;     (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:location#range-radius" }

Switch                  i3RemoteFlash             "Remote Flashlight"        &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:remote#light" } 
Switch                  i3RemoteFinder            "Remote Flashlight"        &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:remote#finder" } 
Switch                  i3RemoteLock              "Remote Flashlight"        &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:remote#lock" } 
Switch                  i3RemoteUnlock            "Remote Flashlight"        &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:remote#unlock" } 
Switch                  i3RemoteHorn              "Remote Flashlight"        &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:remote#horn" } 
Switch                  i3RemoteClimate           "Remote Flashlight"        &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:remote#climate" } 
String                  i3RemoteState             "Remote Flashlight"        &lt;status&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:remote#state" } 

Image                   i3Image                   "Car Image"                &lt;switch&gt; (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:image#rendered" }  

Switch                  i3Troubleshoot            "Force Fingerprint Log"    &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:BEV_REX:user:i3:troubleshoot#cardata-fingerprint" }  
Switch                  i3DiscoveryFinger         "Discovery Fingerprint"    &lt;switch&gt;   (i3)   {channel="bmwconnecteddrive:account:user:discovery-fingerprint"}</code></pre>
		<h3 id="sitemap">Sitemap</h3>
		<pre><code>sitemap BMW label="BMW" {
  Frame label="BMW i3" {
    Image  item=i3Image                     label="Car Image"
  } 
  Frame label="Range" {
    Text    item=i3Mileage                  label="Odometer [%d %unit%]"
    Text    item=i3Range                    label="Range [%d %unit%]"
    Text    item=i3RangeElectric            label="Eletric Range [%d %unit%]"
    Text    item=i3RangeFuel                label="Fuel Range [%d %unit%]"
    Text    item=i3BatterySoc               label="Battery Charge [%.1f %%]"
    Text    item=i3Fuel                     label="Fuel Charge [%.1f %%]"
    Text    item=i3LastUpdate               label="Last Update [%s]"
  }
  Frame label="Status" {
    Text    item=i3DoorStatus               label="Door Status [%s]"
    Text    item=i3WindowStatus             label="Window Status [%s]"
    Text    item=i3LockStatus               label="Lock Status [%s]"
    Text    item=i3ServiceStatus            label="Service [%s]"
    Text    item=i3CheckControl             label="Check Control [%s]"
    Text    item=i3ChargingStatus           label="Charging [%s]"
  }
  Frame label="Remote Services" {
    Switch  item=i3RemoteFlash              label="Flash"
    Switch  item=i3RemoteFinder             label="Finder"
    Switch  item=i3RemoteLock               label="Lock"
    Switch  item=i3RemoteUnlock             label="Unlock"
    Switch  item=i3RemoteHorn               label="Horn"
    Switch  item=i3RemoteClimate            label="Air Conditioning"
    Text    item=i3RemoteState              label="Execution Status"
}
  Frame label="Last Trip" {
    Text    item=i3TripDistance             label="Distance [%d %unit%]"
    Text    item=i3TripDistanceSinceCharge  label="Distance since last Charge [%d %unit%]"
    Text    item=i3AvgTripConsumption       label="Average Consumption [%.1f %unit%]"
    Text    item=i3AvgTripRecuperation      label="Average Recuperation [%.1f %unit%]"
  }
  Frame label="Lifetime" {
    Text    item=i3CumulatedElectric        label="Eletric Distance Driven [%d %unit%]"
    Text    item=i3LongestEVTrip            label="Longest Trip [%d %unit%]"
    Text    item=i3AvgConsumption           label="Average Consumption [%.1f %unit%]"
    Text    item=i3AvgRecuperation          label="Average Recuperation [%.1f %unit%]"      
  }
  Frame label="Location" {
    Text    item=i3Latitude                 label="Latitude  [%.4f]"
    Text    item=i3Longitude                label="Longitude [%.4f]"
    Text    item=i3LatLong                  label="Location  [%s]"
    Text    item=i3Heading                  label="Heading [%.1f %unit%]" 
    Text    item=i3RangeRadius              label="Radius [%d]"   
  }
  Frame label="Troubleshooting" {    
    Switch  item=i3DiscoveryFinger          label="Log Discovery Fingerprint"
    Switch  item=i3Troubleshoot             label="Log CarData Fingerprint"
    
  } 
}</code></pre>
		<h2 id="going-further">Going further</h2>
		<p>You're now able to receive your Vehicle Data in openHAB. Continue the work and combine this data with other Powerful openHAB Bindings and Widgets.</p>
		<h3 id="openstreetmap-widget">OpenstreetMap Widget</h3>
		<h3 id="openweathermap-binding-and-widget">OpenWeatherMap Binding and Widget</h3>
		<p>Especially Electric Vehicles which maybe are charged with your Local Photovoltaic System the Weather forecast and corresponding Cloudiness is interesting.
			Use the OpenWeatherMap Binding and existing 
			<a href="https://community.openhab.org/t/openweathermap-widget-for-habpanel/65027">Widget Solutions</a> to check this data in addition to your Vehicles State of Charge.
		</p>
		<h2 id="credits">Credits</h2>
		<p>This work is based on the work of 
			<a href="https://github.com/bimmerconnected/bimmer_connected">Bimmer Connected</a>. 
			Also a 
			<a href="https://community.openhab.org/t/script-to-access-the-bmw-connecteddrive-portal-via-oh/37345">manual installation based on python</a> was already available for openHAB.
			This Binding is basically a port to openHAB based on these concept works!
			<br/>
		</p>
	</body>
</html>