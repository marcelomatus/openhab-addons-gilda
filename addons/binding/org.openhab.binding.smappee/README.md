# Smappee Binding

This binding integrates the [Smappee energy monitor](http://www.smappee.com).

## Introduction

The Smappee energy monitor monitors how much power your appliances consume and how much you gain from your solar power system in realtime. It can automatically detect the appliances based on their energy consumption pattern. Smappee also offers a water and a gas sensor consumption monitor.

Both the Energy monitor and the Solar energy monitor can be used. These can be bought online in the [smappee webshop](http://www.smappee.com/be_en/eshop/monitors.html).

The smappee supports clamps for 3 phase and 1 phase systems and there is a separate circuit clamp for your solar system. Installation manuals can be found on [their support page](https://www.smappee.com/be_en/support)

## Supported Things

This binding provides one bridge thing type 'smappee'. There should be only one smappee device installed in your home.
This thing act like a bridge and represents your smappee monitor device and should be configured first. Once configured, this will autodetect all other smappee things.

Detected things:

- appliance: A detected appliance. The appliances that are not categorized yet (type is "Find Me") are skipped. 
- actuator: A paired smappee switch.
- sensor: A paired water or gas sensor.

## Discovery

The smappee thing must be configured manually. Appliances, actuators and the sensors are autodetected. 

## Smappee Thing Configuration

As described on their [support page](https://support.smappee.com/hc/en-us/articles/202153935-Where-can-I-find-the-API-documentation-), you need to email [support@smappee.com](mailto:support@smappee.com) to get a client ID and a client secret to access the API. In that mail you need to provide them:

- Full name: your full name
- Monitor serial number: this can be found at the back of your smappee
- Account username: the username you use to log in in Smappee, same as thing setting 'Username'

The following settings must be configured in order to make your smappee binding work:

#### Smappee Bridge

| Configuration Parameter  |                                                                                    |
|--------------------------|------------------------------------------------------------------------------------|
|ClientId                  | The Smappee Api Oauth client id (obtain by mail from smappee support)              |
|ClientSecret              | The Smappee Api Oauth client secret (obtain by mail from smappee support)          |
|Username                  | The username for your Smappee Account                                              |
|Password                  | The password for your Smappee Account                                              |
|ServiceLocationName       | The name of your Smappee installation                                              |
|PollingInterval           | How often (in minutes) does the smappee needs to be checked ? Default is 5 minutes |

#### Appliance Thing

| Configuration Parameter |                                                                                                              |
|-------------------------|--------------------------------------------------------------------------------------------------------------|
|Id                       | The unique identifier of the detected appliance, This is the number after "Find Me" for unlabeled appliances |
|Type                     | This is the smappee category ("Air Conditioner", "Blinds", "Microwave", ...                                  |

#### Actuator Thing

| Configuration Parameter |                                                                                                              |
|-------------------------|--------------------------------------------------------------------------------------------------------------|
|Id                       | The unique identifier of the linked plug, This is a unique number starting from 1 for each installed plug    |

#### Sensor Thing

| Configuration Parameter |                                                                                                              |
|-------------------------|--------------------------------------------------------------------------------------------------------------|
|Id                       | The unique identifier of the sensor, is a combined identifier. Format: [SensorId-ChannelId], eg 1-1          |

## Channels

The following channels are supported:

#### Smappee Bridge

| Channel Type ID                 | Item Type    | Description                                                                |
|---------------------------------|--------------|----------------------------------------------------------------------------|
| monitor-consumption             | Number       | The amount of energy that is being consumed now                            |
| monitor-solar                   | Number       | The amount of energy that is being generated by your solar power panels now|
| monitor-alwayson                | Number       | The amount of energy that is always consumed                               |
 
#### Appliance Thing

| Channel Type ID            | Item Type    | Description                                                    |
|----------------------------|--------------|----------------------------------------------------------------|
| appliance-power            | Number       | The amount of energy that is being consumed now                |
|                            |              | Note: sometimes the API doesn't return any reading,           |
|                            |              | This can be validated in the appliance settings, show events   |

#### Actuator Thing

| Channel Type ID            | Item Type    | Description                                       |
|----------------------------|--------------|---------------------------------------------------|
| actuator-switch            | Switch       | Turn on the switch                                |

#### Sensor Thing 

| Channel Type ID            | Item Type    | Description                                       |
|----------------------------|--------------|---------------------------------------------------|
| sensor-value               | String       | The measured value of this sensor                 | 
 
## Full Example

A manual setup through a `things/smappee.things` file could look like this:

```
Bridge smappee:monitor:mySmappee "Smappee" @ "Living Room" [clientId="xxx", clientSecret="xxx", username="xxx", password="xxx", serviceLocationName="xxx", pollingInterval=5]
{
    Thing smappee:appliance:myAppliance [ id="xxx", type="Blinds" ]
    Thing smappee:actuator:myPlug [ id="xxx" ]
    Thing smappee:sensor:mySensor [ id="xxx" ]
}
```

A manual configuration through a `demo.items` file could look like this:

```
Number mySmappee_Consumption     "Consumption [%s]"      { channel="smappee:monitor:mySmappee:monitor-consumption" }
Number mySmappee_Solar           "Solar [%s]"            { channel="smappee:monitor:mySmappee:monitor-solar" } 
Number mySmappee_AlwaysOn        "Always On [%s]"        { channel="smappee:monitor:mySmappee:monitor-alwayson" }

Number mySmappee_AppliancePower  "Appliance Power [%s]"  { channel="smappee:appliance:myAppliance:appliance-power" }
```

The sitemap could look like this:

```
sitemap home label="My home" {
    Frame label="Energy" {
        Text item=mySmappee_Consumption label="Consumption [%s]" icon="energy"
        Text item=mySmappee_Solar label="Solar [%s]" icon="sun"
        Text item=mySmappee_AlwaysOn label="Always On [%s]" icon="energy"
    }
}
```